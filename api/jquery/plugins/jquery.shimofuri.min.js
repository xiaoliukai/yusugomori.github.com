/*!
 * jquery.shimofuri.js
 *
 * @author:  Yusuke Sugomori (http://yusugomori.com)
 * @license: http://yusugomori.com/license/mit
 * @version: 1.0.1
 * 
 * Usage: $('#canvas').shimofuri();
 * Demo: http://yusugomori.com/dev/shimofuri.js
 * 
*/
(function(b){var a;a=b;return a.fn.shimofuri=function(d){var e,c;e={};c=a.extend(e,d);document.body.style.overflow="hidden";return this.each(function(){var p,n,w,j,A,r,y,s,B,f,g,E,u,o,D,z,q,m,i,C,v,l,t,h,k,x;p=a(this);j=p[0];y=j.getContext("2d");h=document.createElement("canvas");k=h.getContext("2d");l=210;x=0;u=0;t=false;q=null;A=null;n=[null,null];C=function(){x=window.innerWidth*2;u=window.innerHeight*2;j.width=h.width=x;j.height=h.height=u;j.style.width=x/2+"px";return j.style.height=u/2+"px"};z=function(G,I){var H,F,J;if(G==null){G=0}if(I==null){I=1}H=1-Math.random();F=1-Math.random();J=Math.sqrt(-2*Math.log(H));if(0.5-Math.random()>0){return J*Math.sin(Math.PI*2*F)*I+G}else{return J*Math.cos(Math.PI*2*F)*I+G}};f=function(F,L){var K,G,J,I,H;J=["","-o-","-ms-","-moz-","-webkit-"];K=document.createElement("div");for(G=I=0,H=J.length;I<H;G=I+=1){K.style[F]=J[G]+L;if(K.style[F]){return J[G]}K.style[F]=""}};g=f("backgroundImage","linear-gradient(left, #fff, #fff)");w=["#e15f26","#ef5b2e","#ef5532","#f04c2b","#e94a2e","#c63721","#a62b18"];r=[{r:255,g:249,b:243},{r:255,g:249,b:235},{r:255,g:250,b:226},{r:254,g:236,b:210},{r:254,g:230,b:198},{r:248,g:217,b:179},{r:253,g:217,b:165}];m=[[w[2],w[2],r[0]],[w[2],w[2],r[1]],[w[2],w[3],r[0]],[w[2],w[3],r[1]],[w[2],w[4],r[0]],[w[2],w[4],r[1]],[w[3],w[3],r[0]],[w[3],w[3],r[1]],[w[3],w[3],r[2]],[w[3],w[4],r[0]],[w[3],w[4],r[1]],[w[3],w[4],r[2]],[w[4],w[4],r[0]],[w[4],w[4],r[1]],[w[4],w[4],r[2]],[w[5],w[5],r[2]],[w[5],w[5],r[3]],[w[5],w[6],r[2]],[w[5],w[6],r[3]],[w[6],w[6],r[2]],[w[6],w[6],r[3]]];i=function(){var F;F=parseInt(Math.random()*m.length);q=m[F];A=q[2];n=[q[0],q[1]];return j.style.backgroundImage=g+("linear-gradient(left top, "+n[0]+", "+n[1]+")")};v=function(L,O){var Q,H,F,J,K,R,S,P,M,I,G;if(L==null){L=250000}if(O==null){O=true}F=250000;R=[];K=L;Q=x*u/F;if(Q>200){K=L/20;S=Q/3.6}if(Q<200){K=8000;S=50}if(Q<100){K=L/30;S=44}if(Q<90){K=L/28;S=42}if(Q<80){K=L/26;S=38}if(Q<70){K=L/24;S=34}if(Q<60){K=L/22;S=31}if(Q<50){K=L/20;S=23}if(Q<40){K=L/18;S=20}if(Q<30){K=L/17;S=17}if(Q<25){K=L/16;S=15}if(Q<20){K=L/14;S=13}if(Q<15){K=L/12;S=11}if(Q<13){K=L/11;S=10}if(Q<10){K=L/10;S=8}if(Q<8){K=L/7;S=6}if(Q<7){K=L/5;S=5}if(Q<6){K=L/5.5}if(Q<5){K=L/6}if(Q<4.5){K=L/7}if(Q<4){K=L/8}if(Q<3){K=L/12}if(Q<2){K=L/24}if(Q<1){K=L/32}if(Q<0.5){K=L/60}if(Q<0.4){K=L/80}if(Q<0.3){K=L/120}if(Q<0.25){K=L/160}if(Q<0.2){K=L/240}if(Q<0.15){K=L/320}if(Q<0.1){K=L/390}if(Q<0.05){K=L/540}if(O===true){H=1;K/=H;for(J=I=0;I<K;J=I+=1){P=Math.random()*x;M=Math.random()*u;R.push({x:P,y:M,size:S})}}else{S=Math.random()*u/16+6;for(J=G=0;G<K;J=G+=1){P=z(0,0);M=z(0,0);R.push({x:P,y:M,size:S})}}return R};s=function(K,J,H){var L,G,F,I;if(J==null){J=3}if(H==null){H=true}G=K.length;if(H===true){k.clearRect(0,0,x,u)}while(G--){F=K[G];if(F.x>x+F.size){F.x=0-F.size}if(F.x<0-F.size){F.x=x+F.size}if(F.y>u+F.size){F.y=0-F.size}if(F.y<0-F.size){F.y=u+F.size}k.beginPath();L=k.createRadialGradient(F.x,F.y,0,F.x,F.y,F.size);L.addColorStop(0,"rgba("+A.r+","+A.g+","+A.b+",1)");L.addColorStop(1,"rgba("+A.r+","+A.g+","+A.b+",0.1)");k.fillStyle=L;I=Math.random()*J+1;k.setTransform(I,0,0,1,0,0);k.arc(F.x,F.y,F.size,0,Math.PI*2);k.fill()}return D()};D=function(){var G,J,F,I,H;J=k.getImageData(0,0,x,u);F=J.data;for(G=I=0,H=F.length;I<H;G=I+=4){if(F[G+3]<l){F[G+3]/=6;if(F[G+3]>l/4){F[G+3]=0}}}return y.putImageData(J,0,0)};C();i();o=function(){var G,F;G=v();s(G);F=v(20000,false);return s(F,60,false)};o();a(window).on("resize",function(){if(t!==false){clearTimeout(t);t=false}return t=setTimeout(function(){C();return o()},400)});E=function(){var F;F=document.createElement("div");F.setAttribute("ontouchstart","return");return typeof F.ontouchstart==="function"};B="click";if(E()){B="touchstart"}return a(this).on(B,function(F){F.preventDefault();i();o()})})}})(jQuery);