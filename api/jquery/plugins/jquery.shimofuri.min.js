/*!
 * jquery.shimofuri.js
 *
 * @usage: $('#canvas').shimofuri();
 * 
 * @author:  Yusuke Sugomori (http://yusugomori.com)
 * @license: http://yusugomori.com/license/mit
 * @version: 1.0.0
*/
(function(c){var a=[].indexOf||function(f){for(var e=0,d=this.length;e<d;e++){if(e in this&&this[e]===f){return e}}return -1};var b;b=c;return b.fn.shimofuri=function(e){var f,d;f={};d=b.extend(f,e);return this.each(function(){var q,o,x,k,B,s,z,t,C,g,h,v,p,E,A,r,n,j,D,w,m,u,i,l,y;q=b(this);k=q[0];z=k.getContext("2d");i=document.createElement("canvas");l=i.getContext("2d");m=210;y=0;v=0;u=false;r=null;B=null;o=[null,null];D=function(){y=window.innerWidth*2;v=window.innerHeight*2;k.width=i.width=y;k.height=i.height=v;k.style.width=y/2+"px";return k.style.height=v/2+"px"};A=function(G,I){var H,F,J;if(G==null){G=0}if(I==null){I=1}H=1-Math.random();F=1-Math.random();J=Math.sqrt(-2*Math.log(H));if(0.5-Math.random()>0){return J*Math.sin(Math.PI*2*F)*I+G}else{return J*Math.cos(Math.PI*2*F)*I+G}};g=function(F,L){var K,G,J,I,H;J=["","-o-","-ms-","-moz-","-webkit-"];K=document.createElement("div");for(G=I=0,H=J.length;I<H;G=I+=1){K.style[F]=J[G]+L;if(K.style[F]){return J[G]}K.style[F]=""}};h=g("backgroundImage","linear-gradient(left, #fff, #fff)");x=["#e15f26","#ef5b2e","#ef5532","#f04c2b","#e94a2e","#c63721","#a62b18"];s=[{r:255,g:249,b:243},{r:255,g:249,b:235},{r:255,g:250,b:226},{r:254,g:236,b:210},{r:254,g:230,b:198},{r:248,g:217,b:179},{r:253,g:217,b:165}];n=[[x[2],x[2],s[0]],[x[2],x[2],s[1]],[x[2],x[3],s[0]],[x[2],x[3],s[1]],[x[2],x[4],s[0]],[x[2],x[4],s[1]],[x[3],x[3],s[0]],[x[3],x[3],s[1]],[x[3],x[3],s[2]],[x[3],x[4],s[0]],[x[3],x[4],s[1]],[x[3],x[4],s[2]],[x[4],x[4],s[0]],[x[4],x[4],s[1]],[x[4],x[4],s[2]],[x[5],x[5],s[2]],[x[5],x[5],s[3]],[x[5],x[6],s[2]],[x[5],x[6],s[3]],[x[6],x[6],s[2]],[x[6],x[6],s[3]]];j=function(){var F;F=parseInt(Math.random()*n.length);r=n[F];B=r[2];o=[r[0],r[1]];return k.style.backgroundImage=h+("linear-gradient(left top, "+o[0]+", "+o[1]+")")};w=function(L,O){var Q,H,F,J,K,R,S,P,M,I,G;if(L==null){L=250000}if(O==null){O=true}F=250000;R=[];K=L;Q=y*v/F;if(Q>200){K=L/20;S=Q/3.6}if(Q<200){K=8000;S=50}if(Q<100){K=L/30;S=44}if(Q<90){K=L/28;S=42}if(Q<80){K=L/26;S=38}if(Q<70){K=L/24;S=34}if(Q<60){K=L/22;S=31}if(Q<50){K=L/20;S=23}if(Q<40){K=L/18;S=20}if(Q<30){K=L/17;S=17}if(Q<25){K=L/16;S=15}if(Q<20){K=L/14;S=13}if(Q<15){K=L/12;S=11}if(Q<13){K=L/11;S=10}if(Q<10){K=L/10;S=8}if(Q<8){K=L/7;S=6}if(Q<7){K=L/5;S=5}if(Q<6){K=L/5.5}if(Q<5){K=L/6}if(Q<4.5){K=L/7}if(Q<4){K=L/8}if(Q<3){K=L/12}if(Q<2){K=L/24}if(Q<1){K=L/32}if(Q<0.5){K=L/60}if(Q<0.4){K=L/80}if(Q<0.3){K=L/120}if(Q<0.25){K=L/160}if(Q<0.2){K=L/240}if(Q<0.15){K=L/320}if(Q<0.1){K=L/390}if(Q<0.05){K=L/540}if(O===true){H=1;K/=H;for(J=I=0;I<K;J=I+=1){P=Math.random()*y;M=Math.random()*v;R.push({x:P,y:M,size:S})}}else{S=Math.random()*v/16+6;for(J=G=0;G<K;J=G+=1){P=A(0,0);M=A(0,0);R.push({x:P,y:M,size:S})}}return R};t=function(K,J,H){var L,G,F,I;if(J==null){J=3}if(H==null){H=true}G=K.length;if(H===true){l.clearRect(0,0,y,v)}while(G--){F=K[G];if(F.x>y+F.size){F.x=0-F.size}if(F.x<0-F.size){F.x=y+F.size}if(F.y>v+F.size){F.y=0-F.size}if(F.y<0-F.size){F.y=v+F.size}l.beginPath();L=l.createRadialGradient(F.x,F.y,0,F.x,F.y,F.size);L.addColorStop(0,"rgba("+B.r+","+B.g+","+B.b+",1)");L.addColorStop(1,"rgba("+B.r+","+B.g+","+B.b+",0.1)");l.fillStyle=L;I=Math.random()*J+1;l.setTransform(I,0,0,1,0,0);l.arc(F.x,F.y,F.size,0,Math.PI*2);l.fill()}return E()};E=function(){var G,J,F,I,H;J=l.getImageData(0,0,y,v);F=J.data;for(G=I=0,H=F.length;I<H;G=I+=4){if(F[G+3]<m){F[G+3]/=6;if(F[G+3]>m/4){F[G+3]=0}}}return z.putImageData(J,0,0)};D();j();p=function(){var G,F;G=w();t(G);F=w(20000,false);return t(F,60,false)};p();b(window).on("resize",function(){if(u!==false){clearTimeout(u);u=false}return u=setTimeout(function(){D();return p()},400)});C="click";if(a.call(typeof window!=="undefined"&&window!==null,"touchstart")>=0){C="touchstart"}return b(window).on(C,function(F){F.preventDefault();j();return p()})})}})(jQuery);